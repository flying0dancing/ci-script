<div class="flex-row-spaced-between">
  <h1 class="mat-h2">{{ title }}</h1>

  <button
    mat-icon-button
    (click)="closeSidenav()"
    matTooltip="Close ({{ closeFieldFormShortcut }})"
    matTooltipPosition="left"
  >
    <mat-icon>close</mat-icon>
  </button>
</div>

<form [formGroup]="form" autocomplete="off">
  <mat-form-field class="full-width">
    <input
      #firstInput
      matInput
      class="e2e-field-form-name-input"
      placeholder="Field Name"
      formControlName="name"
      required
    />
    <mat-error
      *ngIf="nameControl.errors && nameControl.errors.fieldNamePattern"
    >
      {{ nameControl.errors.fieldNamePattern }}
    </mat-error>
    <mat-error *ngIf="nameControl.errors && nameControl.errors.alreadyExists">
      {{ nameControl.errors.alreadyExists }}
    </mat-error>
  </mat-form-field>

  <mat-form-field class="full-width">
    <mat-select
      (selectionChange)="resetFormValuesAfterTypeSelection()"
      placeholder="Field Type"
      class="e2e-field-form-type-input"
      formControlName="type"
      required
    >
      <mat-option *ngFor="let fieldType of fieldTypes" [value]="fieldType">{{
        fieldType
      }}</mat-option>
    </mat-select>
  </mat-form-field>

  <div class="form-group" *ngIf="typeControl.value === 'string'">
    <mat-form-field class="full-width">
      <input
        matInput
        class="e2e-field-form-max-length-input"
        placeholder="Max Length"
        type="number"
        formControlName="maxLength"
        (change)="onMinMaxChange()"
      />
    </mat-form-field>
    <mat-form-field class="full-width">
      <input
        matInput
        class="e2e-field-form-min-length-input"
        placeholder="Min Length"
        type="number"
        formControlName="minLength"
        (change)="onMinMaxChange()"
      />
    </mat-form-field>
    <mat-form-field class="full-width">
      <input
        matInput
        class="e2e-field-form-min-regex-input"
        placeholder="Regular Expression"
        formControlName="regularExpression"
      />
    </mat-form-field>
  </div>

  <div class="form-group" *ngIf="isDateField()">
    <mat-form-field class="full-width">
      <input
        matInput
        class="e2e-field-form-date-format-input"
        placeholder="Date Format"
        formControlName="format"
      />
      <mat-error *ngIf="formatControl.hasError('required')">
        Please enter a value for date format
      </mat-error>
    </mat-form-field>
  </div>
  <div class="form-group" *ngIf="typeControl.value === 'decimal'">
    <mat-form-field class="full-width">
      <input
        matInput
        class="e2e-field-form-precision-input"
        placeholder="Precision"
        type="number"
        formControlName="precision"
      />
      <mat-error *ngIf="precisionControl.hasError('required')">
        Please enter a value for precision
      </mat-error>
    </mat-form-field>
    <mat-form-field class="full-width">
      <input
        matInput
        class="e2e-field-form-scale-input"
        placeholder="Scale"
        type="number"
        formControlName="scale"
      />
      <mat-error *ngIf="scaleControl.hasError('required')">
        Please enter a value for scale
      </mat-error>
    </mat-form-field>
  </div>

  <mat-checkbox
    color="primary"
    class="e2e-field-form-nullable-input"
    formControlName="nullable"
    [labelPosition]="'before'"
    class="full-width"
  >
    Nullable
  </mat-checkbox>
</form>

<div class="margin-top-3">
  <dv-save-button
    class="e2e-field-form-save-button"
    [displayText]="saveButtonText"
    [disabled]="isFormInvalid()"
    [loading]="loading$ | async"
    [done]="(loaded$ | async) && form.disabled"
    (save)="saveField()"
  >
  </dv-save-button>
</div>
