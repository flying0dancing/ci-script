<div class="flex-row-spaced-between">
  <h1 class="mat-h2">{{ mode + title }}</h1>

  <button
    mat-icon-button
    class="side-nav-close-button"
    (click)="closeSidenav()"
    matTooltipPosition="left">
    <mat-icon>close</mat-icon>
  </button>
</div>

<form [formGroup]="formGroup" class="form-wrapper e2e-create-step-form">
  <mat-form-field class="half-width-left">
    <input
      #firstInput
      matInput
      placeholder="Name"
      class="e2e-create-pipeline-step-name-input"
      [formControlName]="formControlNames.name"
      required
    />

    <mat-error
      *ngIf="
        formGroupControls.name.errors &&
        formGroupControls.name.errors.simpleNamePattern
      "
    >
      {{ formGroupControls.name.errors.simpleNamePattern }}
    </mat-error>
    <mat-error
      *ngIf="
        formGroupControls.name.errors &&
        formGroupControls.name.errors.alreadyExists
      "
    >
      {{ formGroupControls.name.errors.alreadyExists }}
    </mat-error>
  </mat-form-field>

  <mat-form-field class="half-width-right">
    <mat-select
      placeholder="Transformation Type"
      [formControlName]="formControlNames.type"
      class="e2e-create-pipeline-step-transformation-type-input"
      required
    >
      <mat-option
        *ngFor="let type of TransformationType | keyvalue"
        [value]="type.value"
      >{{ type.value }}</mat-option
      >
    </mat-select>
  </mat-form-field>

  <mat-form-field class="full-width">
    <textarea
      matInput
      placeholder="Description"
      [formControlName]="formControlNames.description"
      class="e2e-create-pipeline-step-description-input"
      matTextareaAutosize
    >
    </textarea>
  </mat-form-field>

  <div [ngSwitch]="formGroupValues.type">
    <dv-map-step-sub-form
      *ngSwitchCase="TransformationType.MAP"
      [formControlName]="formControlNames.map"
      [selectExecutionErrors]="executionErrors"
      [schemas]="schemas"
    ></dv-map-step-sub-form>

    <dv-aggregation-step-sub-form
      *ngSwitchCase="TransformationType.AGGREGATION"
      [formControlName]="formControlNames.aggregation"
      [selectExecutionErrors]="executionErrors"
      [schemas]="schemas"
    ></dv-aggregation-step-sub-form>

    <dv-join-step-sub-form
      *ngSwitchCase="TransformationType.JOIN"
      [formControlName]="formControlNames.join"
      [selectExecutionErrors]="executionErrors"
      [schemas]="schemas"
    ></dv-join-step-sub-form>

    <dv-window-step-sub-form
      *ngSwitchCase="TransformationType.WINDOW"
      [selectExecutionErrors]="executionErrors"
      [formControlName]="formControlNames.window"
      [schemas]="schemas"
    ></dv-window-step-sub-form>

    <dv-unions-step-sub-form
      *ngSwitchCase="TransformationType.UNION"
      [selectExecutionErrors]="executionErrors"
      [formControlName]="formControlNames.union"
      [schemas]="schemas"
    ></dv-unions-step-sub-form>

    <dv-scriptlet-step-sub-form
      *ngSwitchCase="TransformationType.SCRIPTLET"
      [selectExecutionErrors]="executionErrors"
      [formControlName]="formControlNames.scriptlet"
      [schemas]="schemas"
    ></dv-scriptlet-step-sub-form>
  </div>
</form>

<dv-step-form-errors [apiErrors]="toTopLevelFormErrors(apiErrors)"></dv-step-form-errors>

<div class="step-actions-container">
  <dv-save-button
    class="e2e-create-pipeline-step-save-button"
    [displayText]="saveButtonText"
    [disabled]="!isFormValid()"
    [loading]="loading"
    [done]="loaded && formGroup.disabled"
    (save)="savePipelineStep()"
  >
  </dv-save-button>
</div>
