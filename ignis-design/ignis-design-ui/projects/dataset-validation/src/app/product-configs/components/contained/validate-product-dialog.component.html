<h1 class="mat-h1" mat-dialog-title>Export Product</h1>

<div mat-dialog-content>
  <mat-card class="validations-container">
    <mat-card-header>
      <div mat-card-avatar>
        <mat-icon>{{ overallStatusIcon }}</mat-icon>
      </div>
      <mat-card-title>Validate Product</mat-card-title>
      <ng-template #template
        ><mat-card-subtitle
          >Product must be validated before exporting</mat-card-subtitle
        ></ng-template
      >
    </mat-card-header>

    <span class="select-all-pipelines-checkbox">
      <mat-checkbox
        [checked]=selectAllPipelineCheckbox
        (change)="updateSelectAll($event)"
      >Select All Pipelines</mat-checkbox>
    </span>
    <mat-tree
      [dataSource]="dataSource"
      [treeControl]="treeControl"
      class="validation-tree"
    >
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
        <li>
          <div class="mat-tree-node">
            <button
              mat-icon-button
              matTreeNodeToggle
              [attr.aria-label]="'toggle ' + node.name"
            ></button>
            <span class="pipeline-icon-space" [ngSwitch]="node.status">
              <mat-icon
                *ngSwitchCase="'SUCCESS'"
                class="success mat-40 material-icons"
                >check_circle</mat-icon
              >
              <mat-icon
                *ngSwitchCase="'FAILED'"
                class="error mat-40 material-icons"
                >error</mat-icon
              >
              <mat-icon
                *ngSwitchCase="'PENDING'"
                class="pending mat-40 material-icons"
                >access_time</mat-icon
              >
              <mat-spinner
                *ngSwitchCase="'RUNNING'"
                color="accent"
                mode="indeterminate"
                matTooltipPosition="left"
                [diameter]="20"
              >
              </mat-spinner>
            </span>
            <span class="step-name">{{ node.name }}</span>
            <span *ngIf="node.status == 'FAILED' && node.message"
              >&nbsp;- {{ node.message }}</span
            >
          </div>
        </li>
      </mat-tree-node>
      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <li>
          <div class="mat-tree-node">
            <button
              mat-icon-button
              matTreeNodeToggle
              [attr.aria-label]="'toggle ' + node.name"
            >
              <mat-icon class="mat-icon-rtl-mirror">
                {{
                  treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'
                }}
              </mat-icon>
            </button>
            <span class="selected-pipeline-checkbox">
                <mat-checkbox
                  [checked]="pipelineCheckboxes[node.pipelineId]"
                  (change)="updatePipelineSelected($event, node)"
                ></mat-checkbox>
              </span>
            <span class="pipeline-icon-space" [ngSwitch]="node.status">
              <mat-icon
                *ngSwitchCase="'SUCCESS'"
                class="success mat-40 material-icons"
                >check_circle</mat-icon
              >
              <mat-icon
                *ngSwitchCase="'FAILED'"
                class="error mat-40 material-icons"
                >error</mat-icon
              >
              <mat-icon
                *ngSwitchCase="'PENDING'"
                class="pending mat-40 material-icons"
                >access_time</mat-icon
              >
              <mat-spinner
                *ngSwitchCase="'RUNNING'"
                color="accent"
                mode="indeterminate"
                matTooltipPosition="left"
                [diameter]="20"
              >
              </mat-spinner>
            </span>
            <span class="step-name">{{ node.name }}</span>
          </div>
          <ul [class.validation-tree-invisible]="!treeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </ul>
        </li>
      </mat-nested-tree-node>
    </mat-tree>
  </mat-card>
</div>

<div mat-dialog-actions class="validate-action-buttons-container">
  <div>
    <button
      mat-raised-button
      color="primary"
      class="e2e-validate-product-button"
      [disabled]="validating || validated || requiresNoValidation"
      (click)="validateProduct()"
    >
      {{validateButtonText}}
      <mat-icon *ngIf="!validating && !validated" inline
        >verified_user</mat-icon
      >

      <mat-icon *ngIf="validating" inline>
        <mat-spinner diameter="20"></mat-spinner>
      </mat-icon>
      <mat-icon *ngIf="validated" color="primary">done</mat-icon>
    </button>

    <button
      mat-raised-button
      color="primary"
      class="e2e-download-product-button"
      (click)="download()"
      download
      matTooltip="Download {{ fileName }}"
    >
      Download
      <mat-icon inline>file_download</mat-icon>
    </button>
  </div>

  <button mat-button (click)="cancel()">Cancel</button>
</div>
