<dv-sidenav [sidenavOpened]="sidenavOpened">
  <div side-content>
    <div [hidden]="showFieldForm">
      <dv-rule-form
        class="e2e-rule-form"
        #ruleForm
        [fields]="fields"
        (submitRuleEvent)="dispatchPostRule($event)"
        (closeSidenavEvent)="closeSidenav()"
        [schemaId]="idParam$ | async"
        [productId]="productIdParam$ | async"
      ></dv-rule-form>
    </div>

    <div [hidden]="!showFieldForm">
      <dv-field-form
        #fieldForm
        class="e2e-field-form"
        (submitFieldEvent)="dispatchPostField($event)"
        (closeSidenavEvent)="closeSidenav()"
        [schemaId]="idParam$ | async"
        [productId]="productIdParam$ | async"
        [fields]="fields"
      ></dv-field-form>
    </div>
  </div>

  <div primary-content>
    <dv-product-breadcrumb
      *ngIf="!!(productName$ | async)"
      [productId]="productId"
      [productName]="productName$ | async"
      [schemaDisplayName]="displayName"
      [breadcrumbLevel]="'SCHEMA'"
    >
    </dv-product-breadcrumb>

    <div *ngIf="schema$ | async">
      <div class="flex-row-spaced-between flex-align-center">
        <h1 class="mat-h1 flex-inline flex-align-center e2e-schema-title">
          {{ schema.displayName }}
        </h1>


        <button
          mat-button
          class="e2e-example-schema-csv-button"
          (click)="createExampleCsv()">
          Example Csv
          <mat-icon inline>file_download</mat-icon>
        </button>

      </div>

      <mat-card>
        <mat-card-content class="schema-detail-inputs-container">
          <div class="schema-input-container">
            <dv-inline-edit
              label="Display Name"
              [required]="true"
              type="text"
              [initialValue]="schema.displayName"
              [editFunction]="editDisplayName"
            >
            </dv-inline-edit>
          </div>
          <div class="schema-input-container">
            <dv-inline-edit
              label="Physical Table Name"
              [required]="true"
              type="text"
              [initialValue]="schema.physicalTableName"
              [editFunction]="editPhysicalTableName"
              makeUppercase="true"
            >
            </dv-inline-edit>
          </div>

          <div class="schema-input-container">
            <dv-inline-date-edit
              label="Start Date"
              [required]="true"
              [initialValue]="schema.startDate | date: 'yyyy-MM-dd'"
              [editFunction]="editStartDate"
            >
            </dv-inline-date-edit>
          </div>

          <div class="schema-input-container">
            <dv-inline-date-edit
              label="End Date"
              [required]="!schema.latest"
              [initialValue]="schema?.endDate | date: 'yyyy-MM-dd'"
              [editFunction]="editEndDate"
            >
            </dv-inline-date-edit>
          </div>
        </mat-card-content>
      </mat-card>

      <div
        class="flex-row-spaced-between flex-align-center schema-attribute-container"
      >
        <div>
          <h2 class="mat-h2 flex-inline flex-align-center">
            <mat-icon class="margin-right-1">library_books</mat-icon>
            Fields
          </h2>
        </div>

        <dv-add-fab-button
          title="Add Field"
          shortcutKey="alt+f"
          class="e2e-add-field-button"
          (add)="addField()"
        >
        </dv-add-fab-button>
      </div>

      <dv-fields-grid
        class="e2e-fields-grid"
        [schemaId]="schema.id"
        [productId]="productId"
        [fields]="fields"
        [orderedFieldIds]="orderedFieldIds"
        [loading]="false"
      >
      </dv-fields-grid>

      <div
        class="flex-row-spaced-between flex-align-center schema-attribute-container"
      >
        <div>
          <h2 class="mat-h2 flex-inline flex-align-center">
            <mat-icon class="margin-right-1">verified_user</mat-icon>
            Rules
          </h2>
          <p>
            <i
            >These rules will run against a dataset, producing validation
              results in the FCR Engine.</i
            >
          </p>
        </div>

        <dv-add-fab-button
          title="Add Rule"
          class="e2e-add-rule-button"

          shortcutKey="alt+r"
          (add)="addRule()"
        >
        </dv-add-fab-button>
      </div>

      <dv-rule-grid
        class="e2e-rules-grid"
        [schemaId]="schema.id"
        [productId]="productId"
        [rules]="rules"
        [loading]="false"
      >
      </dv-rule-grid>
    </div>
  </div>
</dv-sidenav>
